# å“åº”å¼ç³»ç»Ÿçš„ä½œç”¨å’Œå®ç°

## å“åº”å¼æ•°æ®ä¸å‰¯ä½œç”¨å‡½æ•°

``` ts
const obj = { text: 'hello world'}
function effect() {
	document.body.innerText = obj.text
}
obj.text = 'new val'
```

effectå°±æ˜¯ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°ï¼Œå› ä¸ºä¿®æ”¹äº†å¤–ç•Œä¾èµ–çš„æ•°æ®ã€‚
å“åº”å¼æ•°æ®ï¼Œå°±æ˜¯å¸Œæœ›æ•°æ®ä¿®æ”¹ï¼Œå¯ä»¥é‡æ–°æ‰§è¡Œä¸€ä¸‹å‰¯ä½œç”¨å‡½æ•°ã€‚

## å“åº”å¼æ•°æ®çš„åŸºæœ¬å®ç°
å¦‚ä½•æ‰èƒ½å®ç°å“åº”å¼æ•°æ®å‘¢ï¼ŸğŸ¤”
* effect æ–¹æ³•ä¼šæ‰§è¡Œobj.textçš„è¯»å–æ“ä½œ
* å½“ä¿®æ”¹ object.textå€¼æ—¶ï¼Œä¼šè§¦å‘è®¾ç½®æ“ä½œ

è¯»å–æ“ä½œå°† effect å­˜åˆ°ä¸€ä¸ªæ¡¶é‡Œï¼Œè®¾ç½®æ“ä½œå¯ä»¥å°† effect ä»æ¡¶ä¸­å–å‡ºæ¥å¹¶æ‰§è¡Œeffect

æ‹¦æˆª è¯»å–å’Œè®¾ç½®æ“ä½œå¯ä»¥ä½¿ç”¨ proxyçš„æ–¹æ¡ˆ + æ¡¶

``` js
 const target = {
      text: 'init'
    }
    // å­˜å‚¨å‰¯ä½œç”¨å‡½æ•°çš„æ¡¶
    const bucket = new Set();
   
    // const set = 
    const handler = {
      get: (obj, prop) => {
        // å­˜å‚¨åˆ°æ¡¶
        bucket.add(effect)
        return prop in obj ? obj[prop] : 37;
      },
      set: (obj, prop, value) => {
        Reflect.set(obj, prop, value)
        bucket.forEach(fn => {
          fn()
        });
        return true;
      }
    }
    const p = new Proxy(target, handler)
    const effect = () => {
      document.body.innerText = p.text
    }
    // æ‰§è¡Œè§¦å‘ get
    effect();
    setTimeout( () => {
      // è§¦å‘ set
      p.text = 'saber'
    }, 1000)
```


## è®¾è®¡ä¸€ä¸ªå®Œå–„çš„å“åº”å¼ç³»ç»Ÿ

æ‰€æœ‰çš„

![](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F149a94f8ec803adb57c902ac1460ed6c8df1fb10.jpg&refer=http%3A%2F%2Fi0.hdslb.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1662199369&t=17f900bb5e27801d38b76559b48d4ade)

* æµ‹è¯•1
* æµ‹è¯•2

