# 微前端架构和挑战

微前端代表一个业务领域，它是自治的、可独立交付的并由单个团队拥有。本描述中的关键要点（稍后将讨论）与微前端背后的原则密切相关：

* 业务领域表示
* 自治代码库
* 独立部署
* 单一团队所有权

微前端提供了许多机会。选择合适的取决于项目要求、组织结构和开发人员的经验。在这些架构中，我们面临一些特定的成功挑战，这些挑战取决于我们希望如何在微前端之间进行通信，我们希望如何将用户从一个视图路由到另一个视图，以及最重要的是，我们如何确定微前端的大小。一个微前端。

在本章中，我们将介绍在启动具有微前端架构的项目时要做出的关键决策。然后，我们将讨论一些在生产中使用微前端的公司及其方法。

## 微前端决策框架

构建微前端应用程序有不同的方法。要为我们的项目选择最佳方法，我们需要了解我们将在其中运行的环境。一些架构决策需要预先做出，因为它们将指导未来的决策，例如
 
如何定义微前端，如何编排不同的视图，如何为用户构建最终视图，以及微前端如何通信和共享数据。这些类型的决策称为微前端决策框架。它由四个关键领域组成：

* 定义架构中的微前端是什么  Defining what a micro-frontend is in your architecture
* 组成微前端  Composing micro-frontends
* 路由微前端  Routing micro-frontends
* 微前端之间的通信 Communicating between micro-frontends

### Define Micro-Frontends 定义微前端

让我们从第一个关键决定开始，这将对其他决定产生重大影响。我们需要从技术角度确定我们如何考虑微前端。我们可以决定在同一个视图中有多个微前端，或者每个视图只有一个微前端（图 3-1）。


通过水平拆分，多个微前端将在同一个视图上。多个团队将负责部分视图，并且需要协调他们的工作。考虑到我们甚至可以在不同的视图中重用一些微前端，这种方法提供了更大的灵活性，尽管它还需要更多的纪律和治理才能在同一个项目中不使用数百个微前端

在垂直拆分场景中，每个团队负责一个业务领域，例如身份验证或目录体验。在这种情况下，领域驱动设计 (DDD) 就派上用场了。我们很少将 DDD 原则应用于前端架构，但在这种情况下，我们有充分的理由去探索它。

DDD 是一种软件开发方法，它的开发中心是对域模型进行编程，该域模型对域的过程和规则有丰富的理解。为前端应用 DDD 与我们在后端可以做的略有不同。某些概念绝对不适用，尽管还有其他概念对于设计成功的微前端架构至关重要。例如，Netflix 的核心领域是视频流；该核心域中的子域是目录、注册功能和视频播放器。

共有三种子域类型：

Core subdomains 核心子域

这些是应用程序应该存在的主要原因。在我们的组织中，核心子域应被视为优质公民，因为它们提供的价值高于一切。视频目录将是 Netflix 的核心子域。

Supporting subdomains 支持子域

这些子域与核心域相关，但不是关键区别。它们可以支持核心子域，但对于为用户提供真正的价值并不是必不可少的。一个例子是 Netflix 视频的投票系统。

Generic subdomains 通用子域

这些子域用于完成平台。公司通常决定为他们使用现成的软件，因为
他们与他们的领域没有严格的关系。例如，对于 Netflix，支付管理与核心子域（目录）无关，但它是平台的关键部分，因为它可以访问经过身份验证的部分。

让我们用这些类别来分解 Netflix（见表 3-1）。


|  Subdomain type 子域类型      |  Example 例子 |
| ----------- | ----------- |
|  Core subdomain      |  Catalog 目录       |
|  Supportive subdomain   | Voting system 投票系统|  
|  Generic subdomain   |  Sign-in or sign-up   |


### Domain-Driven Design with Micro-Frontends 具有微前端的领域驱动设计

DDD 中的另一个重要术语是有界上下文：隐藏实现细节的逻辑边界，公开 API 合约以使用其中存在的模型中的数据。

通常，有界上下文将由域和子域定义的业务区域转换为我们定义模型、代码结构以及潜在的团队的逻辑区域。限界上下文通过在它们之间创建契约来定义不同上下文相互通信的方式，通常由 API 表示。这允许团队同时在不同的子域上工作，同时尊重预先定义的合同。

通常在一个新项目中，子域会重叠有界上下文，因为我们可以自由地以最佳方式设计我们的系统。因此，我们可以将特定的子域分配给团队，以交付定义合同的特定业务价值。然而，在遗留软件中，有界上下文可以容纳多个子域，因为这些系统的设计通常没有考虑到 DDD。

微前端生态系统提供了许多技术方法。一些实现是使用 iframe 完成的，而另一些是使用组件库或 Web 组件完成的。我们常常把时间花在确定技术解决方案上，而没有考虑到业务方面。

想想这个场景：三个团队，分布在三个不同的位置，在同一个代码库上工作。这些团队可能会在微前端使用 iframe 或 Web 组件进行横向拆分。

一段时间后，他们意识到同一视图中的微前端需要以某种方式进行通信。然后，其中一个团队将负责聚合视图内的不同部分。团队将花费更多时间在同一个视图中聚合不同的微前端并进行调试，以确保一切正常。

显然，这是过于简单化了。考虑到不同的时区、团队之间的交叉依赖、知识共享或分布式团队结构，情况可能会更糟。所有这些挑战很容易升级为士气低落和交付延误之外的挫败感。因此，我们需要确保我们所走的道路不会让我们的团队失望。

然而，从业务的角度来处理项目，您可以创建一个独立的微前端，而无需跨多个子域进行通信。让我们重新想象一下我们的场景。我们不是使用组件和 iframe，而是使用单页应用程序 (SPA) 和单页。这种方法允许一个完整的团队设计构成视图所需的所有 API，并创建根据流量扩展服务所需的基础设施。微架构、微服务和微前端的组合提供了独立交付，而不会危及整个系统以在生产中发布。

有界上下文有助于设计我们的系统，但我们需要很好地了解业务如何运作，以确定项目内部的正确边界。作为架构师或技术主管，我们的职责是与产品团队或客户投入足够的时间，以便我们能够识别不同的领域和子领域，与他们合作。

在定义了所有有界上下文之后，我们将拥有一个系统地图，代表我们系统所组成的不同区域。在图 3-2 中，我们可以看到有界上下文的表示。在此示例中，有界上下文包含目录微前端，这些微前端通过唯一的入口点（前端的后端）使用来自微服务架构的 API。我们将在第 8 章研究更多关于 API 集成的内容。

在 DDD 中，前端没有被考虑在内，但是当我们使用垂直拆分的微前端时，我们可以很容易地将前端和后端映射到同一个有界上下文中。

我经常看到公司根据康威定律设计系统，该定律指出，“设计系统的组织被限制生产的设计是这些组织的通信结构的副本。”1 这些公司需要他们的团队结构而不是灵活足以适应组织的最佳解决方案，以减少摩擦并更快地朝着最终目标迈进：拥有让客户满意的优质产品！逆康威策略建议发展您的团队和组织结构以推广您想要的架构。

### How to Define a Bounded Context   如何定义有界上下文

过早的优化总是指日可待，这可能导致我们的子域分解，我们在其中分割有界上下文以适应未来的集成。相反，我们需要等到我们有足够的信息来做出明智的决定。

因为我们的业务会随着时间的推移而发展，所以我们还需要审查与有界上下文相关的决策。有时我们从更大的有界上下文开始。随着时间的推移，业务不断发展，最终有界上下文变得难以管理或过于复杂。所以我们决定拆分它。决定拆分有界上下文可能会导致大量代码重构，但也可能大大简化代码库，从而加速未来的新功能和开发。

为避免过早分解，我们将在最后一刻做出决定。通过这种方式，我们可以获得更多信息并清楚地了解我们需要遵循的方向。在定义子域时，我们必须提前与组织内的产品团队或领域专家接触。它们可以为您提供系统运行位置的上下文。始终从数据和指标开始。例如，我们可以轻松了解用户如何与我们的应用程序交互，以及用户通过身份验证和未通过身份验证时的用户旅程。数据在识别子域时提供了强大的清晰度，并且可以帮助创建初始基线，从中我们可以看到我们是否正在改进系统。




