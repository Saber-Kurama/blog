
ğŸ¤”ï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªå“åº”å¼ç³»ç»Ÿ

æ‰€è°“å“åº”å¼ç³»ç»Ÿï¼Œå…¶å®å°±æ˜¯å°†å‰¯ä½œç”¨æ–¹æ³•å’Œå’Œå…¶ä¾èµ–çš„æ•°æ®è¿›è¡Œå…³è”
ä¹Ÿå°±æ˜¯åœ¨å‰¯ä½œç”¨ä¸­æ”¶é›†ä¾èµ–æ•°æ®ï¼Œå½“ä¾èµ–æ•°æ®å‘ç”Ÿä¿®æ”¹çš„æ—¶å€™ï¼Œå‰¯ä½œç”¨å‘ç”Ÿä¿®æ”¹

ğŸ¤”ï¼šå¦‚ä½•æ”¶é›†ä¾èµ–æ•°æ®

å‰¯ä½œç”¨ä¸­è®¿é—®ä¾èµ–æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ ¹æ® `proxy`çš„getter æ¥æ”¶é›†ä¾èµ–ï¼Œå¹¶å°†å‰¯ä½œç”¨æ”¾åˆ°ä¸€ä¸ªæ¡¶ä¸­, å½“å¯¹æ•°æ®èµ‹å€¼ï¼Œè§¦å‘`setter`å°±ä¼šè°ƒç”¨ å‰¯ä½œç”¨å‡½æ•°

ğŸ¤”ï¼šå‰¯ä½œç”¨ä¸­æ²¡æœ‰çš„keyå‘ç”Ÿä¿®æ”¹ä¸åº”è¯¥è§¦å‘å‰¯ä½œç”¨

å®šä¹‰ä¸€ä¸ªå…¨å±€ `activeEffect`å˜é‡æ¥è§£å†³ `effect` åç§°å›ºå®šçš„é—®é¢˜ 
ä¸ºäº†è§£å†³ä¸Šé¢é—®é¢˜ï¼Œå¿…é¡»ä¿®æ”¹æ•°æ®çš„å­˜å‚¨æ–¹å¼
ä½¿ç”¨ `weakmap` æ¥å­˜å‚¨å“åº”å¼å¯¹è±¡ï¼Œå¥½å¤„æ˜¯å¼±å¼•ç”¨ï¼Œå¯¹è±¡é”€æ¯ï¼Œ`weakmap`ä¹Ÿä¼šé”€æ¯
ä½¿ç”¨ `map` æ¥å­˜å‚¨å¯¹è±¡çš„`key`, å‰¯ä½œç”¨å‡½æ•°ä¾ç„¶æ˜¯`Set`

ğŸ¤”ï¼š åˆ†æ”¯å’Œcleanup

æŸäº›æƒ…å†µä¸‹ï¼Œå‰¯ä½œç”¨æœ‰ if ç­‰åˆ†æ”¯æ¡ä»¶è¯­å¥ï¼Œä¼šé€ æˆå‰¯ä½œç”¨å’Œä¹‹å‰çš„æ•°æ®ä¸å†å…³è”
è§£å†³æ–¹æ¡ˆï¼Œæ˜¯æ¯æ¬¡é‡æ–°æ‰§è¡Œå‰¯ä½œç”¨ä¹‹å‰å…ˆåˆ é™¤ä¹‹å‰çš„å…³è”ï¼Œé‡æ–°å»ºç«‹è¿æ¥

ä¸ºäº†å¯ä»¥æ¸…é™¤æ—§é“¾æ¥ï¼Œå¯ä»¥é‡‡ç”¨ ç»™å‰¯ä½œç”¨å‡½æ•° æ·»åŠ `deps`ä¾èµ–ã€‚è¿™æ ·å°±å¯ä»¥æ¸…é™¤

ğŸ¤”ï¼š å¦‚ä½•è§£å†³åµŒå¥— `effect`å‘¢

`effect`çš„åµŒå¥—è§£å†³æ–¹æ¡ˆå…¶å®å°±æ˜¯åˆ›å»º `effect`æ ˆ

ğŸ¤”ï¼š`effect` å’Œ `proxy`è¿›è¡Œå…³è”ä¹‹åï¼Œæ˜¯å¦å¯ä»¥æ§åˆ¶`effect`çš„æ‰§è¡Œæ—¶é—´æˆ–è€…æ¬¡æ•°ï¼Ÿ

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ `scheduler`è°ƒåº¦å™¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜

ğŸ¤”ï¼š `computed` å’Œ`lazy` 

é€šè¿‡ä¼ é€’å±æ€§`options`, `effect(fn, options)` å°±å¯ä»¥æ§åˆ¶æ˜¯å¦ç«‹å³æ‰§è¡Œ`fn`

`computed` è¿”å›ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œåªæœ‰å½“ è·å– `value` å€¼çš„æ—¶å€™æ‰ä¼šè§¦å‘ `fn`


```js
const computed = () => {
	return Proxy {
		get() {
			return x
		}
	}
}
```




