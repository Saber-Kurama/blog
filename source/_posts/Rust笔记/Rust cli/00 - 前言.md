# Preface


## Who Should Read This Book 谁该读这本书


如果你正在读这篇文章，我猜你至少已经知道一种编程语言。

也许你的背景是静态类型语言，如c++或Java，或者像我一样，你来自动态类型语言的世界。

在我的职业生涯中，我大部分时间都在使用Perl和Python进行web开发和系统任务，但我一直对学习Prolog和Haskell到JavaScript和Lisp非常感兴趣。

不管你的背景如何，我都希望向你展示Rust是一门非常有趣的语言。



Rust需要学习一些关于内存和类型的非常低级的东西，所以我不能想象它会是一门很棒的第一语言。

我将把大量的细节内容转移到参考书籍中，如《Programming Rust》(Blandy, Orendorff和Tindall;O 'Reilly, 2021)和The Rust编程语言(Klabnik和Nichols;No Starch Press, 2019)。

我强烈建议您阅读其中一本或两本，并与这本书一起深入研究语言本身。

这本书将集中在如何写实际的程序，从零开始和工作一步一步添加功能，构建你的程序，工作通过错误消息，并测试你的逻辑。

如果您想学习如何编写解决常见系统问题的完整程序，您应该阅读这本书。

尽管我将展示为什么Rust特别适合这样做，但我认为您也应该尝试用您知道的其他语言编写这些程序，这样您就可以对比使Rust更好或更差、更容易或更困难的因素。



最后，如果您关心测试，您也应该阅读这本书。

我是测试驱动开发的倡导者，我首先编写测试，然后尝试编写通过这些测试的代码。

我的教学经验使我相信这是一种思考问题的有效方法。

我的观点是，测试通常会产生更好的代码。

如果您目前不使用测试，我希望您在这里看到足够的测试实用程序示例，以便采用这种实践。

## 为什么你应该学习Rust

您对Rust感兴趣的原因有很多。

就我个人而言，Rust的类型系统非常吸引我。

我越多地使用静态类型语言，就越意识到动态类型语言迫使程序员编写正确的程序和测试。

我越使用Rust，就越发现编译器是我的舞伴，而不是敌人。

当然，你的舞伴会在你每次踩到他们的脚趾或错过一个提示时告诉你，但这最终会让你成为一个更好的舞者，这是最终的目标。



我喜欢Rust的一个原因是，我可以很容易地与非开发人员分享我编写的程序。

如果我为一个同事写一个Python程序，我必须给他们Python源代码来运行。

这意味着我还必须确保用户安装了正确版本的Python以及执行我的代码所需的所有模块。

相反，Rust程序被直接编译成机器可执行文件。

我可以在我的机器上编写和调试一个程序，为它需要运行的架构构建一个可执行程序，并给我的同事一份程序的副本。

假设他们有正确的体系结构，他们就不需要安装Rust，可以直接运行程序。

Rust程序的易用性和大小也适用于我创建的容器。

例如，具有Python运行时的Docker容器可能需要数百 MB。

相比之下，我可以构建一个裸骨的Linux VM，其Rust二进制文件可能只有数十 MB大小。

除非我真的需要Python的一些特殊功能，如机器学习或自然语言处理模块，否则我更喜欢用Rust编写，并拥有更小、更精简的容器。

我对Rust的大多数发现是，我工作效率很高。

我在Rust身上发现的主要是，我非常高效。

在很长一段时间里，我对Lisp和Haskell这样的语言有着学生般的迷恋，但我从未成功地用这些语言编写过任何有用的程序。

明确地说，我通常编写需要接受一些参数、向文件或数据库读写数据、从互联网获取数据等的命令行程序。

像Haskell这样的语言会让我不堪重负，因为它们的库中有难以理解的文档，并产生难以理解的错误消息。

相反，我可以很容易地找到许多有用的、有良好文档记录的Rust板条箱—这就是在Rust板条箱中所称的库。Io，使用编译器工作感觉就像与一个非常聪明的同事进行结对编程，他会发现错误，并经常准确地建议如何修复它们。

## 编码的挑战

这是一本给你写的编码挑战的书。

我不希望你在上班的公交车上被动地读这本书，然后把它收起来。

对于每一章，我希望您编写一个程序，它将通过我为您编写的测试套件。

通过编写自己的解决方案，你将学到最多的东西，但我相信，即使是输入我给出的源代码，也会证明是有益的。

我选择的问题主要来自Unix命令行核心utils，因为我希望读者已经非常熟悉这些。

例如，我假设您已经使用了head and tail来查看文件的前几行或最后几行，但是您曾经编写过这些程序的自己版本吗?

Rust似乎希望重写现有的程序，尤其是最初用C或c++编写的程序，所以这是我的另一个动机。

您可以在网上找到许多其他由rustacean编写的这些程序的示例，因此您可以将您的代码与我的解决方案以及您将找到的其他解决方案进行对比。

除此之外，这些都是相当简单的项目，可以在每个项目中教授一些技能。

我已经对它们进行了排序，所以它们是相互依存的，所以最好是你按顺序读完所有章节

我选择这些节目的一个原因是，它们提供了一种地面真相。

虽然Unix有很多不同的版本，这些程序的实现也有很多，但它们的工作方式通常都是一样的，产生的结果也是一样的。

我在开发中使用macOS，这意味着我主要运行这些程序的BSD (Berkeley Standard Distribution)或GNU (GNU的非Unix)变体。

一般来说，BSD版本早于GNU版本，而且选项更少。

对于每个挑战程序，我使用一个shell脚本将原始程序的输出重定向到输出文件中。

目标是让Rust程序为相同的输入创建相同的输出。

我一直小心地包含在Windows上编码的文件以及混合了Unicode字符的简单ASCII文本，以迫使我的程序以与原始程序相同的方式处理行结束符和字符的各种想法。

对于大多数挑战，我只会尝试实现原始程序的一个子集，因为它们可能会变得相当复杂。

我还选择在一些程序的输出中做一些小改变，这样它们更容易教。

就像通过播放录音来学习演奏一种乐器。

你不需要演奏原版的每一个音符。

重要的是学习常见的模式，比如处理参数和阅读输入，这样你就可以继续写材料了。


## Getting Rust and the Code

首先，你需要安装 Rust。
关于 Rust，我最喜欢的部分之一是用于安装、升级和管理 Rust 的 rustup 工具。
它在Windows和Unix类型的操作系统（OS）上同样有效，如Linux和macOS。
您需要按照操作系统的安装说明进行操作。
如果你已经安装了 rustup，你可能希望运行 **rustup update** 来获取最新版本的语言和工具，因为 Rust 大约每六周更新一次。
执行 rustup 文档以阅读大量文档。
您可以使用以下命令检查 rustc 编译器的版本：

``` shell
❯ rustc --version
rustc 1.56.1 (59eed8a2a 2021-11-01)
```

程序的所有代码、数据和测试都可以在我的 GitHub 存储库中找到。
可以使用 Git 源代码管理工具（可能需要安装）来获取代码的副本。
以下命令将在您的计算机上创建一个名为 [command-line-rust](https://github.com/kyclark/command-line-rust) 的新目录，其中包含存储库的内容：

```
git clone git@github.com:kyclark/command-line-rust.git
```

您将遇到的第一批工具之一是 **Cargo**，它是 Rust 的构建工具、包管理器和测试运行器。
您可以使用它来编译和测试第 1 章的代码。
切换到目录并使用 cargo test 运行测试：

```
$ cd 01_hello
$ cargo test
```

本书中所有的代码都是使用`rustfmt`进行格式化的，这是一个非常方便的工具，可以让你的代码看起来更漂亮、更易读。

您可以使用`cargo fmt`在项目中的所有源代码上运行它，或者您可以将它集成到代码编辑器中以按需运行。

例如，我更喜欢使用文本编辑器vim，我已将其配置为每次保存工作时自动运行rustfmt。

我发现这使得我的代码更容易阅读和发现错误。


我建议你使用[`Clippy`](https://github.com/rust-lang/rust-clippy)，一个用于Rust代码的linter。

Linting是自动检查代码中常见错误的方法，似乎大多数语言都提供了一个或多个Linting。

rustfmt和clippy都应该默认安装，但是如果你需要安装clippy，你可以使 `rustup component add clippy`。

然后，您可以运行 cargo clippy 让它检查源代码并提出建议。
没有来自Clippy的输出意味着它没有建议。

现在你可以开始写Rust了!
